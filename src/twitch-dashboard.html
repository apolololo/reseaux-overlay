<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Twitch</title>
    <link rel="stylesheet" href="styles/twitch.css">
</head>
<body class="twitch-container">
    <header class="twitch-header">
        <div class="twitch-user-info" id="twitch-user-info">
            <img id="twitch-profile-image" src="" alt="Profile" style="display: none;">
            <span id="twitch-username"></span>
        </div>
        <button id="twitch-logout" class="twitch-button">Déconnexion</button>
    </header>

    <main>
        <h2>Overlays Twitch</h2>
        <div class="overlay-list">
            <div class="overlay-item">
                <h3>Starting Screen</h3>
                <a href="overlays/twitch/starting/overlay.html" target="_blank" class="twitch-button">Ouvrir</a>
            </div>
            <div class="overlay-item">
                <h3>BRB Screen</h3>
                <a href="overlays/twitch/brb/overlay.html" target="_blank" class="twitch-button">Ouvrir</a>
            </div>
            <div class="overlay-item">
                <h3>End Screen</h3>
                <a href="overlays/twitch/end/overlay.html" target="_blank" class="twitch-button">Ouvrir</a>
            </div>
        </div>
    </main>

    <script>
        // Vérification du token Twitch
        function checkTwitchAuth() {
            const twitchToken = localStorage.getItem('twitch_access_token');
            const twitchExpiresAt = localStorage.getItem('twitch_expires_at');

            if (!twitchToken || !twitchExpiresAt || Date.now() > parseInt(twitchExpiresAt)) {
                window.location.href = 'auth-twitch.html';
                return;
            }

            loadTwitchUserInfo(twitchToken);
        }

        // Chargement des informations de l'utilisateur Twitch
        async function loadTwitchUserInfo(token) {
            try {
                const response = await fetch('https://api.twitch.tv/helix/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Client-Id': 'votre_client_id'
                    }
                });
                
                if (!response.ok) throw new Error('Erreur API Twitch');
                
                const data = await response.json();
                const user = data.data[0];
                
                document.getElementById('twitch-username').textContent = user.display_name;
                const profileImage = document.getElementById('twitch-profile-image');
                profileImage.src = user.profile_image_url;
                profileImage.style.display = 'block';
                
                localStorage.setItem('twitch_user_info', JSON.stringify(user));
            } catch (error) {
                console.error('Erreur:', error);
                localStorage.removeItem('twitch_access_token');
                localStorage.removeItem('twitch_expires_at');
                window.location.href = 'auth-twitch.html';
            }
        }

        // Gestion de la déconnexion
        document.getElementById('twitch-logout').addEventListener('click', () => {
            localStorage.removeItem('twitch_access_token');
            localStorage.removeItem('twitch_expires_at');
            localStorage.removeItem('twitch_user_info');
            window.location.href = 'auth-twitch.html';
        });

        // Vérification de l'authentification au chargement
        checkTwitchAuth();
    </script>
</body>
</html>