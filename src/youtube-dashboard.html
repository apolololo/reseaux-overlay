<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard YouTube</title>
    <link rel="stylesheet" href="styles/youtube.css">
    <link rel="stylesheet" href="styles/overlay.css">
</head>
<body>
    <header>
        <div class="user-info" id="youtube-user-info">
            <img id="profile-image" src="" alt="Profile">
            <div class="user-details">
                <h1 id="channel-name">Chargement...</h1>
                <p id="subscriber-count">Chargement...</p>
            </div>
        </div>
        <button id="logout-button" class="youtube-button">D√©connexion</button>
    </header>

    <main>
        <div class="dashboard-section">
            <h2>R√©seaux & Code</h2>
            <div class="overlay-grid">
                <div class="overlay-item">
                    <h3>Starting Soon</h3>
                    <a href="overlays/youtube/starting/overlay.html" target="_blank" class="youtube-button">Ouvrir</a>
                </div>
                <div class="overlay-item">
                    <h3>Pause</h3>
                    <a href="overlays/youtube/brb/overlay.html" target="_blank" class="youtube-button">Ouvrir</a>
                </div>
                <div class="overlay-item">
                    <h3>Fin du Stream</h3>
                    <a href="overlays/youtube/end/overlay.html" target="_blank" class="youtube-button">Ouvrir</a>
                </div>
                <div class="overlay-item">
                    <h3>Status de Jeu</h3>
                    <a href="overlays/game-status/overlay.html" target="_blank" class="youtube-button">Ouvrir</a>
                </div>
                <div class="overlay-item">
                    <h3>Maps</h3>
                    <a href="overlays/maps/overlay.html" target="_blank" class="youtube-button">Ouvrir</a>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <a href="privacy.html" class="footer-link">Politique de confidentialit√©</a>
    </footer>

    <script>
        // V√©rification du token YouTube
        function checkYouTubeAuth() {
            const googleToken = localStorage.getItem('google_access_token');
            const googleExpiresAt = localStorage.getItem('google_expires_at');

            if (!googleToken || !googleExpiresAt || Date.now() > parseInt(googleExpiresAt)) {
                window.location.href = 'auth-youtube.html';
                return;
            }

            loadYouTubeChannelInfo(googleToken);
        }

        // Chargement des informations de la cha√Æne YouTube
        async function loadYouTubeChannelInfo(token) {
            try {
                const response = await fetch('https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&mine=true', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) throw new Error('Erreur API YouTube');
                
                const data = await response.json();
                const channel = data.items[0];
                
                document.getElementById('channel-name').textContent = channel.snippet.title;
                document.getElementById('subscriber-count').textContent = `üë• ${parseInt(channel.statistics.subscriberCount).toLocaleString()} abonn√©s`;
                
                const profileImage = document.getElementById('profile-image');
                profileImage.src = channel.snippet.thumbnails.default.url;
                profileImage.style.display = 'block';
                
                localStorage.setItem('youtube_channel_info', JSON.stringify(channel));
            } catch (error) {
                console.error('Erreur:', error);
                localStorage.removeItem('google_access_token');
                localStorage.removeItem('google_expires_at');
                window.location.href = 'auth-youtube.html';
            }
        }

        // Gestion de la d√©connexion
        document.getElementById('logout-button').addEventListener('click', () => {
            localStorage.removeItem('google_access_token');
            localStorage.removeItem('google_expires_at');
            localStorage.removeItem('youtube_channel_info');
            window.location.href = 'auth-youtube.html';
        });

        // V√©rification de l'authentification au chargement
        checkYouTubeAuth();
    </script>
</body>
</html>