<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Authentification</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: #f5f5f5;
    }
    
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .twitch-button {
      background-color: #9146FF;
      color: white;
    }
    
    .google-button {
      background-color: white;
      color: #444;
      border: 1px solid #ddd;
    }
    
    img {
      height: 24px;
      width: auto;
    }
  </style>
</head>
<body>
  <h1>Test d'Authentification</h1>
  <p>Cliquez sur un bouton pour tester la connexion</p>
  
  <button onclick="connectTwitch()" class="twitch-button">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Twitch_Glitch_Logo_Purple.svg/878px-Twitch_Glitch_Logo_Purple.svg.png" alt="Twitch">
    Connexion avec Twitch
  </button>
  
  <button onclick="connectGoogle()" class="google-button">
    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">
    Connexion avec Google
  </button>
  
  <div id="result" style="margin-top: 20px; padding: 10px; background-color: #eee; display: none;"></div>
  
  <script>
    // Fonction pour afficher un message
    function showResult(message) {
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = message;
      resultDiv.style.display = 'block';
    }
    
    // Fonction pour se connecter avec Twitch
    function connectTwitch() {
      showResult("Tentative de connexion avec Twitch...");
      
      try {
        // ID client Twitch
        const clientId = "z8q1w4g12yrql6cyb5zzwmhe1pnxyn";
        
        // URL de redirection
        const redirectUri = "https://uejmtvhqzadtxrqtowtm.supabase.co/auth/v1/callback";
        
        // Générer un état aléatoire pour la sécurité
        const state = Math.random().toString(36).substring(2, 15);
        localStorage.setItem('twitch_auth_state', state);
        
        // Construire l'URL d'authentification Twitch
        const scope = 'user:read:email channel:read:subscriptions moderator:read:followers';
        const authUrl = `https://id.twitch.tv/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${encodeURIComponent(scope)}&state=${state}&force_verify=true`;
        
        console.log("URL de redirection Twitch:", redirectUri);
        console.log("URL d'authentification Twitch:", authUrl);
        
        // Rediriger vers l'authentification Twitch
        window.location.href = authUrl;
      } catch (error) {
        showResult("Erreur: " + error.message);
        console.error("Erreur lors de la redirection Twitch:", error);
      }
    }
    
    // Fonction pour se connecter avec Google
    function connectGoogle() {
      showResult("Tentative de connexion avec Google...");
      
      try {
        // ID client Google
        const clientId = "1098123020683-iqtdlh9g8hgkbvqp4qm7hgb9jd3s0dih.apps.googleusercontent.com";
        
        // URL de redirection
        const redirectUri = "https://uejmtvhqzadtxrqtowtm.supabase.co/auth/v1/callback";
        
        // Générer un état aléatoire pour la sécurité
        const state = Math.random().toString(36).substring(2, 15);
        localStorage.setItem('google_auth_state', state);
        
        // Construire l'URL d'authentification Google
        const scope = 'email profile https://www.googleapis.com/auth/youtube.readonly';
        const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${encodeURIComponent(scope)}&state=${state}&access_type=offline&prompt=consent`;
        
        console.log("URL de redirection Google:", redirectUri);
        console.log("URL d'authentification Google:", authUrl);
        
        // Rediriger vers l'authentification Google
        window.location.href = authUrl;
      } catch (error) {
        showResult("Erreur: " + error.message);
        console.error("Erreur lors de la redirection Google:", error);
      }
    }
  </script>
</body>
</html>